<!DOCTYPE HTML>
<html>
<meta charset="utf-8">
<head>
<title> testing pixi</title>
<script src="https://cdn.socket.io/socket.io-1.1.0.js"></script>
<script src="pixi.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="rules.js"></script>

</head>
<body>

<p id="status"> WAiting for other players</p>
<p id="p1"> </p>
<p id="p1Hand"</p>
<p id="p2"> </p>
<p id="p3Hand"</p>
<p id="p3"> </p>
<p id="p4Hand"</p>
<p id="p4"> </p>
<p id="p4Hand"</p>

<script>






// Connection variables and global variables
var socket= io.connect('http://localhost:3000/');
var full=false;
var PlayerHand;
var username;
var roomid;
var currturn;
var HandImageList=[];


// Pixie JS 
var screenWidth=980;
var screenHeight=980;
var renderer =  new PIXI.autoDetectRenderer(screenWidth,screenHeight);
var texture;
var loader = PIXI.loader;
// ATTACH canvas to DOM
document.body.appendChild(renderer.view);
var stage = new PIXI.Container();
stage.alpha = 1;

var CardSheet = PIXI.BaseTexture.fromImage("/images/playingCards2.png");
var deckContainer = [];
var AnimationFrameDeckDeal;
var backcard;  	
  


// Display users that join the server
function updateStatus(users){
         
		var count =1;

        for(var i=0;i<users.length;i++){		
        	if(users[i]!=null){
        		//console.log(i);
        		var pid ="p"+(i+1);
        		document.getElementById(pid).innerHTML="Player "+ users[i].username +" has connected";


        	}
        }

        
		
	//	document.getElementById("p2").innerHTML="Player "+users[1].username +" has connected";
		if(users.length==1){

			document.getElementById("status").innerHTML="Game Starting";
			// Load playing Card sprite sheet + other sprites
		
			
			


			

			
			//PIXI.loader.load(setup);
			// Add as needed

			full=true;
		}
		}




// Poll for users joining the game
 // Intial user list

 socket.on('playerlist',function(users){
		//console.log(users);
		console.log(users);
		updateStatus(users);
	});


	

socket.on('updateList',function (users){
	//console.log(users);
	console.log("i got everything");
	var identifier = document.cookie.split(';');
	 username = identifier[0].split('=')[1];
	 roomid = identifier[1].split('=')[1];
     //console.log(roomid);
     //console.log(username);
     //console.log(users);
	 if (roomid!=users[0].roomid){
	 	return;
	 	console.log('different room ');
	 }
	 else{updateStatus(users); console.log('same room');}



	
	
	

});

// once game is full, get hands from server


socket.on('startgame',function(newgame){
	console.log("Got here");
	//console.log(newgame);
   // console.log(newgame.Hand);
    PlayerHand=newgame.Hand;  
    //compare(PlayerHand[0],PlayerHand[1]);
   // console.log(PlayerHand);
  
   PlayerHand=sortie(PlayerHand);
   

   
   
  

    
    if(newgame.turn==true){
    	console.log("My turn");



    }
	
    setup(); 




});


    function sortie(A){
              var tits =[];
             //console.log(A);
        var val=A[0];
        var index=0;
 	if(A.length==2){
            if(A[0].value <A[1].value){return A;}
            else{ var t = A[0]; A[0]=A[1]; A[1]=t; return A;}
            
            
            
        }

 	else{
            
            
            
            
            for(var i =1; i<=A.length-1;i++){
                if(A[i].value <val.value){
                    val=A[i];
                    index=i;
                
                
            }  else if(A[i].value==val.value){
                
                    if(A[i].rank<val.rank){
                        val=A[i];
                        index=i;
                    }
                
                
                
                
                
            }
        }    
            var tmp = A[0];
            A[0]=val;
            A[index]=tmp;     
            
           
            tits.push(val);
            
            return tits.concat(sortie(A.slice(1,A.length)));
            
            
 				










 		
                





 	}
 	


 	
                   
                }

// PIXIE.JS STUFF



// CAll pixie to load resource into cache, call function setup to intialize it 
//PIXI.loader.add("/images/cat2.png").load(setup);
// Function when loading image , should load cat
function setup(){


// Setup Deck and Dealing Animation


// Setups player's Hand images
 
LoadDeckAnimation();


AnimationFrameDeckDeal=window.requestAnimationFrame(function() {AnimateDeck(0);});




console.log(deckContainer);
//AnimationFrameDeckDeal=window.requestAnimationFrame(AnimateDeck(0));
//window.requestAnimationFrame(AnimateDeck);

CardsSetup(PlayerHand);


renderer.render(stage);
}


function LoadDeckAnimation(){

console.log("Loading Deck Animation");
	

for (x = 0 ; x <= 12 ;x++){
	var temp =new PIXI.Sprite.fromImage('/images/cardBack_red4.png');

    temp.position.y=400-x;
    temp.position.x=490-x;
    stage.addChild(temp);
    deckContainer.push(temp);
   
}



renderer.render(stage);






}

function AnimateDeck(cardCount){
	var count = cardCount;
	   console.log(count);
  
	if(count>12){
		count=0;
		 console.log(count);
		renderer.render(stage);}
  		 var card = this.deckContainer[count];
	
	      console.log(count);
		switch(count%4){


				case 0 :
						
						if(card.position.y<=100){
								return window.cancelAnimationFrame(AnimationFrameDeckDeal);
								
							break;
						}
						else{
							card.y-=100;
								return window.cancelAnimationFrame(AnimationFrameDeckDeal);
								
						
							break;}
						

				case 1 :
						if(card.position.y>=700){
								return window.cancelAnimationFrame(AnimationFrameDeckDeal);
								
							break;
						}else{
						
						card.y+=100;
						break;
						}

				case 2 :
						if(card.position.x>=800){
								return window.cancelAnimationFrame(AnimationFrameDeckDeal);
							
							break;



						}else{
						card.x+=100;
						break;			
					}

				case 3 :
						
						if(card.position.x<=100){
								return window.cancelAnimationFrame(AnimationFrameDeckDeal);
								
							break;
						}else{
						card.x-=100;
						break;
					}
	}
	

	
    // directioion variable , 0 = north, 1 = east, 2, south, 3 north;
    renderer.render(stage);
    count = count+1;
  
	window.requestAnimationFrame(function(){ AnimateDeck(count);});

				 
	
	}
	
		
		 




function CardsSetup(Hand){
		
     
		
		

// each card is 70 x 90 pix
console.log(Hand.length);
var SpadeX =0;
var SpadeY=0;
var HeartX =70;
var HeartY=0;
var CloverX =210;
var CloverY=0;
var DiaX =140;
var DiaY=0;




	 var locx;
	 var locy;
for(i =0; i <Hand.length;i++){
	  console.log(Hand[i]);
	 switch(Hand[i].rank){

	 	case 1 :
	 		locx=140;
	 		break;
	 	case 2:
	 		locx=210;
	 		break;
	 	case 3:
	 		locx=70;
	 		break;
	 	case 4:
	 		locx=0;
	 		break;
	 	}

	 	switch(Hand[i].value){


	 		case 12 :
	 			locy=0;
	 			break;
	 		case 13:
	 			locy=190;
	 			break;
	 		case 11:
	 			locy=180;
	 			break;
	 		case 90 :
	 			locy=270;
	 			break;
	 		case 10:
	 			locy=360;
	 			break;
	 		case 9 :
	 			locy=450;
	 			break;
	 			
	 		case 8:
	 			locy=540;
	 			break;
	 		case 7 :
	 			locy=630;
	 			break;
	 		case 6:
	 			locy=720;
	 			break;
	 		case 5 :
	 			locy=810;
	 			break;
	 		case 4 :
	 			locy=900;
	 			break;
	 		case 3:
	 			locy=990;
	 			break;

	 		case 100:
	 			locy=1080;
	 			break;










	 	}
       

       var Cardframe = new PIXI.Texture(CardSheet, new PIXI.Rectangle(locx,locy,70,90));
       var newCardImage = new PIXI.Sprite(Cardframe);
       
       HandImageList.push(newCardImage);

       for(x =0 ; x < HandImageList.length;x++){
        HandImageList[x].x=x+x*HandImageList[x].width;
        HandImageList[x].y=800;

		stage.addChild(HandImageList[x]);

		renderer.render(stage);


}


}

}





renderer.render(stage);
</script>

</body>
</html>
