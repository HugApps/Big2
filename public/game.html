<!DOCTYPE HTML>
<html>
<meta charset="utf-8">
<head>
<title> testing pixi</title>
<script src="https://cdn.socket.io/socket.io-1.1.0.js"></script>
<script src="pixi.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="rules.js"></script>

</head>
<body>

<p id="status"> WAiting for other players</p>
<p id="p1"> </p>
<p id="p1Hand"</p>
<p id="p2"> </p>
<p id="p3Hand"</p>
<p id="p3"> </p>
<p id="p4Hand"</p>
<p id="p4"> </p>
<p id="p4Hand"</p>

<script>






// Connection variables and global variables
var socket= io.connect('http://localhost:3000/');
var full=false;
var PlayerHand;
var username;
var roomid;
var currturn;



// Pixie JS 
var renderer =  new PIXI.autoDetectRenderer(500,500);
var texture;
var loader = PIXI.loader;
// ATTACH canvas to DOM
document.body.appendChild(renderer.view);
var stage = new PIXI.Container();
stage.alpha = 1;




  	
  


// Display users that join the server
function updateStatus(users){
         
		var count =1;

        for(var i=0;i<users.length;i++){		
        	if(users[i]!=null){
        		//console.log(i);
        		var pid ="p"+(i+1);
        		document.getElementById(pid).innerHTML="Player "+ users[i].username +" has connected";


        	}
        }

        
		
	//	document.getElementById("p2").innerHTML="Player "+users[1].username +" has connected";
		if(users.length==1){

			document.getElementById("status").innerHTML="Game Starting";
			// Load playing Card sprite sheet + other sprites
		
			
			


			

			
			//PIXI.loader.load(setup);
			// Add as needed

			full=true;
		}
		}




// Poll for users joining the game
 // Intial user list

 socket.on('playerlist',function(users){
		//console.log(users);
		console.log(users);
		updateStatus(users);
	});


	

socket.on('updateList',function (users){
	//console.log(users);
	console.log("i got everything");
	var identifier = document.cookie.split(';');
	 username = identifier[0].split('=')[1];
	 roomid = identifier[1].split('=')[1];
     //console.log(roomid);
     //console.log(username);
     //console.log(users);
	 if (roomid!=users[0].roomid){
	 	return;
	 	console.log('different room ');
	 }
	 else{updateStatus(users); console.log('same room');}



	
	
	

});

// once game is full, get hands from server


socket.on('startgame',function(newgame){
	console.log("Got here");
	//console.log(newgame);
   // console.log(newgame.Hand);
    PlayerHand=newgame.Hand;  
    //compare(PlayerHand[0],PlayerHand[1]);
   // console.log(PlayerHand);
   PlayerHand=sortie(PlayerHand);
   console.log(PlayerHand);

   
   
  // var cear = new Combo(PlayerHand);
    //console.log(cear);
   //loadCards(PlayerHand);

    // Render Hand Graphics

    
    if(newgame.turn==true){
    	console.log("My turn");



    }
	
    setup(); 




});


    function sortie(A){
              var tits =[];
             //console.log(A);
        var val=A[0];
        var index=0;
 	if(A.length==2){
            if(A[0].value <A[1].value){return A;}
            else{ var t = A[0]; A[0]=A[1]; A[1]=t; return A;}
            
            
            
        }

 	else{
            
            
            
            
            for(var i =1; i<=A.length-1;i++){
                if(A[i].value <val.value){
                    val=A[i];
                    index=i;
                
                
            }  else if(A[i].value==val.value){
                
                    if(A[i].rank<val.rank){
                        val=A[i];
                        index=i;
                    }
                
                
                
                
                
            }
        }    
            var tmp = A[0];
            A[0]=val;
            A[index]=tmp;     
            
           
            tits.push(val);
            
            return tits.concat(sortie(A.slice(1,A.length)));
            
            
 				










 		
                





 	}
 	


 	
                   
                }

// PIXIE.JS STUFF



// CAll pixie to load resource into cache, call function setup to intialize it 
//PIXI.loader.add("/images/cat2.png").load(setup);
// Function when loading image , should load cat
function setup(){

 loader.add("cardsheet","/images/cat.png");
 loader.load();
 loader.on('progress', function(loader, resource){ 
  	        console.log("progress");
  			console.log(loader.progress);
  			//console.log(loader);

  		});
  loader.on('complete',CardsSetup(PlayerHand));



//var cat2 = new PIXI.Sprite(PIXI.loader.resources["/images/cat.png"].texture);



//stage.addChild(cat2);
//cat2.position.y=202;
renderer.render(stage);

}

function CardsSetup(Hand){


        //var cat1 = new PIXI.Sprite(loader.resources["cats"].texture);
        // console.log(cat1);
        // console.log(cat1.texture);
        //console.log(loader.resources.cardsheet);
       
		var image = new PIXI.Sprite(loader.resources.cardsheet.texture);
		console.log(image);
		console.log(image.texture);
	 	image.x=100;
	 	image.y=100;
	 	//cat1.x=40;
	 //	cat1.y=50;
	    console.log(stage);
	    console.log(stage.renderable);
	 	stage.addChild(image);
	 	console.log(stage.children);
	 	//console.log(stage.childern);
	 	//stage.addChild(cat1);
	 	renderer.render(stage);

// each card is 70 x 90 pix

var SpadeX =0;
var SpadeY=0;
var HeartX =70;
var HeartY=0;
var CloverX =210;
var CloverY=0;
var DiaX =140;
var DiaY=0;




	 var locx;
	 var locy;
	 switch(Hand[0].rank){

	 	case 1 :
	 		locx=140;
	 		break;
	 	case 2:
	 		locx=210;
	 		break;
	 	case 3:
	 		locx=70;
	 		break;
	 	case 4:
	 		locx=0;
	 		break;
	 	}

	 	switch(Hand[0].value){


	 		case 12 :
	 			locy=0;
	 			break;
	 		case 13:
	 			locy=190;
	 			break;
	 		case 11:
	 			locy=180;
	 			break;
	 		case 90 :
	 			locy=270;
	 			break;
	 		case 10:
	 			locy=360;
	 			break;
	 		case 9 :
	 			locy=450;
	 			break;
	 			
	 		case 8:
	 			locy=540;
	 			break;
	 		case 7 :
	 			locy=630;
	 			break;
	 		case 6:
	 			locy=720;
	 			break;
	 		case 5 :
	 			locy=810;
	 			break;
	 		case 4 :
	 			locy=900;
	 			break;
	 		case 3:
	 			locy=990;
	 			break;

	 		case 100:
	 			locy=1080;
	 			break;










	 	}
       






}





renderer.render(stage);
</script>

</body>
</html>
